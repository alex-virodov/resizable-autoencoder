<script language="JavaScript">
    function debugMessage(message) {
        document.getElementById('debug').innerHTML += message + '<br/>';
    }

    function previewImage() {
        debugMessage('Entered previewImage()');
        const [file] = document.getElementById('input_file').files;
        if (file) {
            document.getElementById('input_image').src = URL.createObjectURL(file);
        }
    }

    function processImage() {
        debugMessage('Entered processImage()');
        // https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch
        const formData = new FormData();
        const [file] = document.getElementById('input_file').files;
        formData.append('input_file', file);

        if (!file) {
            debugMessage('Error: Missing file!');
            return;
        }

        debugMessage('Starting fetch from /predict_cells api');
        fetch('/predict_cells', {
            method: 'POST',
            body: formData,
        })
        .then(response => {
            debugMessage('Got response, ok is: ' + response.ok);
            if (!response.ok) {
                throw new Error('Response not ok');
            }
            return response.blob();
        })
        .then(blob => {
            debugMessage('Got blob');
            document.getElementById('processed_image').src = URL.createObjectURL(blob);
        })
        .catch(error => {
            debugMessage(error)
        })
    }
</script>

<body onload="previewImage()">
    Data: <input type="file" id="input_file" onchange="previewImage()"/><br/>
    <input type="button" value="process image" onclick="processImage()"/><br/>

    <img id="input_image" style="border: 1px solid blue;"/>
    <img id="processed_image" style="border: 1px solid blue;"/>

    <div id="debug" style="border: 1px solid green;">
        debug:<br/>
    </div>
</body>